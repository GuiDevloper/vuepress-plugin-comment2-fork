{"version":3,"file":"Waline.js","sources":["../../../src/client/components/Waline.ts"],"sourcesContent":["import {\r\n  usePageData,\r\n  usePageFrontmatter,\r\n  usePageLang,\r\n  withBase,\r\n} from \"@vuepress/client\";\r\nimport { pageviewCount } from \"@waline/client/dist/pageview.mjs\";\r\nimport {\r\n  type VNode,\r\n  computed,\r\n  defineAsyncComponent,\r\n  defineComponent,\r\n  h,\r\n  nextTick,\r\n  onMounted,\r\n  watch,\r\n} from \"vue\";\r\nimport { LoadingIcon, useLocaleConfig } from \"vuepress-shared/client\";\r\n\r\nimport {\r\n  type CommentPluginFrontmatter,\r\n  type WalineLocaleConfig,\r\n  type WalineOptions,\r\n} from \"../../shared/index.js\";\r\n\r\nimport \"@waline/client/dist/waline.css\";\r\nimport \"../styles/waline.scss\";\r\n\r\ndeclare const COMMENT_OPTIONS: WalineOptions;\r\n\r\ndeclare const WALINE_META: boolean;\r\ndeclare const WALINE_LOCALES: WalineLocaleConfig;\r\n\r\nconst walineOption = COMMENT_OPTIONS;\r\nconst walineLocales = WALINE_LOCALES;\r\nconst enableWaline = Boolean(walineOption.serverURL);\r\n\r\nif (WALINE_META)\r\n  import(\r\n    /* webpackChunkName: \"waline\" */ \"@waline/client/dist/waline-meta.css\"\r\n  );\r\n\r\nexport { pageviewCount };\r\n\r\nexport default defineComponent({\r\n  name: \"WalineComment\",\r\n\r\n  setup() {\r\n    const page = usePageData();\r\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\r\n    const lang = usePageLang();\r\n    const walineLocale = useLocaleConfig(walineLocales);\r\n\r\n    let abort: () => void;\r\n\r\n    const enableComment = computed(() => {\r\n      if (!enableWaline) return false;\r\n      const pluginConfig = walineOption.comment !== false;\r\n      const pageConfig = frontmatter.value.comment;\r\n\r\n      return (\r\n        // Enable in page\r\n        Boolean(pageConfig) ||\r\n        // not disabled in anywhere\r\n        (pluginConfig !== false && pageConfig !== false)\r\n      );\r\n    });\r\n\r\n    const enablePageViews = computed(() => {\r\n      if (!enableWaline) return false;\r\n      const pluginConfig = walineOption.pageview !== false;\r\n      const pageConfig = frontmatter.value.pageview;\r\n\r\n      return (\r\n        // Enable in page\r\n        Boolean(pageConfig) ||\r\n        // not disabled in anywhere\r\n        (pluginConfig !== false && pageConfig !== false)\r\n      );\r\n    });\r\n\r\n    const walineKey = computed(() => withBase(page.value.path));\r\n\r\n    const walineProps = computed(() => ({\r\n      lang: lang.value === \"zh-CN\" ? \"zh-CN\" : \"en\",\r\n      locale: walineLocale.value,\r\n      dark: \"html.dark\",\r\n      ...walineOption,\r\n      path: walineKey.value,\r\n    }));\r\n\r\n    onMounted(() => {\r\n      watch(\r\n        walineKey,\r\n        () => {\r\n          abort?.();\r\n\r\n          if (enablePageViews.value)\r\n            void nextTick().then(() => {\r\n              setTimeout(() => {\r\n                abort = pageviewCount({\r\n                  serverURL: walineOption.serverURL,\r\n                  path: walineKey.value,\r\n                });\r\n              }, walineOption.delay || 800);\r\n            });\r\n        },\r\n        { immediate: true }\r\n      );\r\n    });\r\n\r\n    return (): VNode | null =>\r\n      enableComment.value\r\n        ? h(\r\n            \"div\",\r\n            { class: \"waline-wrapper\", id: \"comment\" },\r\n            enableWaline\r\n              ? h(\r\n                  defineAsyncComponent({\r\n                    loader: async () =>\r\n                      (\r\n                        await import(\r\n                          /* webpackChunkName: \"waline\" */ \"@waline/client/dist/component.mjs\"\r\n                        )\r\n                      ).Waline,\r\n                    loadingComponent: LoadingIcon,\r\n                  }),\r\n                  walineProps.value\r\n                )\r\n              : []\r\n          )\r\n        : null;\r\n  },\r\n});\r\n"],"names":[],"mappings":"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"}