{"version":3,"file":"Twikoo.js","sources":["../../../src/client/components/Twikoo.ts"],"sourcesContent":["import { usePageData, usePageFrontmatter, usePageLang } from \"@vuepress/client\";\r\nimport {\r\n  type VNode,\r\n  computed,\r\n  defineComponent,\r\n  h,\r\n  nextTick,\r\n  onMounted,\r\n  ref,\r\n  watch,\r\n} from \"vue\";\r\nimport { LoadingIcon } from \"vuepress-shared/client\";\r\n\r\nimport {\r\n  type CommentPluginFrontmatter,\r\n  type TwikooOptions,\r\n} from \"../../shared/index.js\";\r\n\r\nimport \"../styles/twikoo.scss\";\r\n\r\ndeclare const COMMENT_OPTIONS: TwikooOptions;\r\n\r\nconst twikooOption = COMMENT_OPTIONS;\r\nconst enableTwikoo = Boolean(twikooOption.envId);\r\n\r\nexport default defineComponent({\r\n  name: \"TwikooComment\",\r\n\r\n  setup() {\r\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\r\n    const lang = usePageLang();\r\n    const page = usePageData();\r\n\r\n    const loaded = ref(false);\r\n\r\n    const enableComment = computed(() => {\r\n      if (!enableTwikoo) return false;\r\n      const pluginConfig = twikooOption.comment !== false;\r\n      const pageConfig = frontmatter.value.comment;\r\n\r\n      return (\r\n        // Enable in page\r\n        Boolean(pageConfig) ||\r\n        // not disabled in anywhere\r\n        (pluginConfig !== false && pageConfig !== false)\r\n      );\r\n    });\r\n\r\n    const initTwikoo = async (): Promise<void> => {\r\n      if (enableComment.value) {\r\n        const [{ init }] = await Promise.all([\r\n          import(/* webpackChunkName: \"twikoo\" */ \"twikoo\"),\r\n          new Promise<void>((resolve) => {\r\n            setTimeout(() => {\r\n              void nextTick().then(resolve);\r\n            }, twikooOption.delay || 800);\r\n          }),\r\n        ]);\r\n\r\n        loaded.value = true;\r\n\r\n        await init({\r\n          lang: lang.value === \"zh-CN\" ? \"zh-CN\" : \"en\",\r\n          ...twikooOption,\r\n          el: \"#twikoo-comment\",\r\n        });\r\n      }\r\n    };\r\n\r\n    onMounted(() => {\r\n      watch(\r\n        () => [enableComment.value, page.value.path],\r\n        () => initTwikoo(),\r\n        { immediate: true }\r\n      );\r\n    });\r\n\r\n    return (): VNode =>\r\n      h(\r\n        \"div\",\r\n        {\r\n          class: \"twikoo-wrapper\",\r\n          id: \"comment\",\r\n          style: { display: enableComment.value ? \"block\" : \"none\" },\r\n        },\r\n        loaded.value ? h(\"div\", { id: \"twikoo-comment\" }) : h(LoadingIcon)\r\n      );\r\n  },\r\n});\r\n"],"names":[],"mappings":";;;;;AAsBA,MAAM,YAAe,GAAA,eAAA,CAAA;AACrB,MAAM,YAAA,GAAe,OAAQ,CAAA,YAAA,CAAa,KAAK,CAAA,CAAA;AAE/C,aAAe,eAAgB,CAAA;AAAA,EAC7B,IAAM,EAAA,eAAA;AAAA,EAEN,KAAQ,GAAA;AACN,IAAA,MAAM,cAAc,kBAA6C,EAAA,CAAA;AACjE,IAAA,MAAM,OAAO,WAAY,EAAA,CAAA;AACzB,IAAA,MAAM,OAAO,WAAY,EAAA,CAAA;AAEzB,IAAM,MAAA,MAAA,GAAS,IAAI,KAAK,CAAA,CAAA;AAExB,IAAM,MAAA,aAAA,GAAgB,SAAS,MAAM;AACnC,MAAA,IAAI,CAAC,YAAA;AAAc,QAAO,OAAA,KAAA,CAAA;AAC1B,MAAM,MAAA,YAAA,GAAe,aAAa,OAAY,KAAA,KAAA,CAAA;AAC9C,MAAM,MAAA,UAAA,GAAa,YAAY,KAAM,CAAA,OAAA,CAAA;AAErC,MAAA;AAAA;AAAA,QAEE,QAAQ,UAAU,CAAA;AAAA,QAEjB,YAAA,KAAiB,SAAS,UAAe,KAAA,KAAA;AAAA,QAAA;AAAA,KAE7C,CAAA,CAAA;AAED,IAAA,MAAM,aAAa,YAA2B;AAC5C,MAAA,IAAI,cAAc,KAAO,EAAA;AACvB,QAAA,MAAM,CAAC,EAAE,IAAA,EAAM,CAAI,GAAA,MAAM,QAAQ,GAAI,CAAA;AAAA,UACnC;AAAA;AAAA,YAAwC,QAAA;AAAA,WAAQ;AAAA,UAChD,IAAI,OAAc,CAAA,CAAC,OAAY,KAAA;AAC7B,YAAA,UAAA,CAAW,MAAM;AACf,cAAK,KAAA,QAAA,EAAW,CAAA,IAAA,CAAK,OAAO,CAAA,CAAA;AAAA,aAC9B,EAAG,YAAa,CAAA,KAAA,IAAS,GAAG,CAAA,CAAA;AAAA,WAC7B,CAAA;AAAA,SACF,CAAA,CAAA;AAED,QAAA,MAAA,CAAO,KAAQ,GAAA,IAAA,CAAA;AAEf,QAAA,MAAM,IAAK,CAAA;AAAA,UACT,IAAM,EAAA,IAAA,CAAK,KAAU,KAAA,OAAA,GAAU,OAAU,GAAA,IAAA;AAAA,UACzC,GAAG,YAAA;AAAA,UACH,EAAI,EAAA,iBAAA;AAAA,SACL,CAAA,CAAA;AAAA,OACH;AAAA,KACF,CAAA;AAEA,IAAA,SAAA,CAAU,MAAM;AACd,MAAA,KAAA;AAAA,QACE,MAAM,CAAC,aAAA,CAAc,KAAO,EAAA,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,QAC3C,MAAM,UAAW,EAAA;AAAA,QACjB,EAAE,WAAW,IAAK,EAAA;AAAA,OACpB,CAAA;AAAA,KACD,CAAA,CAAA;AAED,IAAA,OAAO,MACL,CAAA;AAAA,MACE,KAAA;AAAA,MACA;AAAA,QACE,KAAO,EAAA,gBAAA;AAAA,QACP,EAAI,EAAA,SAAA;AAAA,QACJ,OAAO,EAAE,OAAA,EAAS,aAAc,CAAA,KAAA,GAAQ,UAAU,MAAO,EAAA;AAAA,OAC3D;AAAA,MACA,MAAA,CAAO,KAAQ,GAAA,CAAA,CAAE,KAAO,EAAA,EAAE,IAAI,gBAAiB,EAAC,CAAI,GAAA,CAAA,CAAE,WAAW,CAAA;AAAA,KACnE,CAAA;AAAA,GACJ;AACF,CAAC,CAAA;;;;"}