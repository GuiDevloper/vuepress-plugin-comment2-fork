{"version":3,"file":"Artalk.js","sources":["../../../src/client/components/Artalk.ts"],"sourcesContent":["import { usePageData, usePageFrontmatter, useSiteData } from \"@vuepress/client\";\r\nimport type Artalk from \"artalk\";\r\nimport {\r\n  type VNode,\r\n  computed,\r\n  defineComponent,\r\n  h,\r\n  nextTick,\r\n  onMounted,\r\n  shallowRef,\r\n  watch,\r\n} from \"vue\";\r\n\r\nimport {\r\n  type ArtalkOptions,\r\n  type CommentPluginFrontmatter,\r\n} from \"../../shared/index.js\";\r\n\r\nimport \"artalk/dist/Artalk.css\";\r\nimport \"../styles/artalk.scss\";\r\n\r\ndeclare const COMMENT_OPTIONS: ArtalkOptions;\r\n\r\nconst artalkOptions = COMMENT_OPTIONS;\r\n\r\nconst enableArtalk = Boolean(artalkOptions.server);\r\n\r\nexport default defineComponent({\r\n  // eslint-disable-next-line vue/multi-word-component-names\r\n  name: \"Artalk\",\r\n\r\n  props: {\r\n    /**\r\n     * Whether the component is in darkmode\r\n     *\r\n     * 组件是否处于夜间模式\r\n     */\r\n    darkmode: Boolean,\r\n  },\r\n\r\n  setup: (props) => {\r\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\r\n    const page = usePageData();\r\n    const site = useSiteData();\r\n\r\n    const artalkContainer = shallowRef<HTMLDivElement>();\r\n\r\n    let artalk: Artalk.default | null = null;\r\n\r\n    const enableComment = computed(() => {\r\n      if (!enableArtalk) return false;\r\n      const pluginConfig = artalkOptions.comment !== false;\r\n      const pageConfig = frontmatter.value.comment;\r\n\r\n      return (\r\n        // Enable in page\r\n        Boolean(pageConfig) ||\r\n        // not disabled in anywhere\r\n        (pluginConfig !== false && pageConfig !== false)\r\n      );\r\n    });\r\n\r\n    const initArtalk = async (): Promise<void> => {\r\n      if (enableComment.value)\r\n        await Promise.all([\r\n          import(/* webpackChunkName: \"artalk\" */ \"artalk\"),\r\n          new Promise<void>((resolve) => {\r\n            setTimeout(() => {\r\n              void nextTick().then(resolve);\r\n            }, artalkOptions.delay || 800);\r\n          }),\r\n        ]).then(([{ default: _Artalk }]) => {\r\n          // FIXME: Typescript type issues\r\n          const Artalk = _Artalk as unknown as typeof _Artalk.default;\r\n\r\n          try {\r\n            artalk = new Artalk({\r\n              useBackendConf: false,\r\n              site: site.value.title,\r\n              pageTitle: page.value.title,\r\n              ...artalkOptions,\r\n              el: artalkContainer.value!,\r\n              pageKey: page.value.path,\r\n              darkMode: props.darkmode,\r\n            });\r\n\r\n            if (artalkOptions.useBackendConf)\r\n              artalk.on(\"conf-loaded\", () => {\r\n                artalk!.setDarkMode(props.darkmode);\r\n              });\r\n          } catch (err) {\r\n            // FIXME: Not sure what the issue is, relevant issue:\r\n            // https://github.com/vuepress/vuepress-next/issues/1249\r\n            // https://github.com/ArtalkJS/Artalk/discussions/367\r\n          }\r\n        });\r\n    };\r\n\r\n    onMounted(() => {\r\n      watch(\r\n        () => [enableComment.value, page.value.path],\r\n        async () => {\r\n          artalk?.destroy();\r\n          await initArtalk();\r\n        },\r\n        { immediate: true }\r\n      );\r\n\r\n      watch(\r\n        () => props.darkmode,\r\n        (value) => {\r\n          artalk?.setDarkMode(value);\r\n        }\r\n      );\r\n    });\r\n\r\n    return (): VNode | null =>\r\n      enableComment.value\r\n        ? h(\r\n            \"div\",\r\n            { class: \"artalk-wrapper\" },\r\n            h(\"div\", { ref: artalkContainer })\r\n          )\r\n        : null;\r\n  },\r\n});\r\n"],"names":[],"mappings":"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"}