{"version":3,"file":"Giscus.js","sources":["../../../src/client/components/Giscus.ts"],"sourcesContent":["import {\r\n  usePageData,\r\n  usePageFrontmatter,\r\n  usePageLang,\r\n  withBase,\r\n} from \"@vuepress/client\";\r\nimport { type VNode, computed, defineComponent, h, onMounted, ref } from \"vue\";\r\nimport { LoadingIcon } from \"vuepress-shared/client\";\r\n\r\nimport {\r\n  type CommentPluginFrontmatter,\r\n  type GiscusInputPosition,\r\n  type GiscusMapping,\r\n  type GiscusOptions,\r\n  type GiscusRepo,\r\n  type GiscusTheme,\r\n} from \"../../shared/index.js\";\r\n\r\nimport \"../styles/giscus.scss\";\r\n\r\ndeclare const COMMENT_OPTIONS: GiscusOptions;\r\n\r\nexport const SUPPORTED_LANGUAGES = [\r\n  \"ar\",\r\n  \"de\",\r\n  \"gsw\",\r\n  \"en\",\r\n  \"es\",\r\n  \"fa\",\r\n  \"fr\",\r\n  \"id\",\r\n  \"it\",\r\n  \"ja\",\r\n  \"ko\",\r\n  \"nl\",\r\n  \"pl\",\r\n  \"pt\",\r\n  \"ro\",\r\n  \"ru\",\r\n  \"th\",\r\n  \"tr\",\r\n  \"uk\",\r\n  \"vi\",\r\n  \"zh-CN\",\r\n  \"zh-TW\",\r\n] as const;\r\n\r\ntype BooleanString = \"0\" | \"1\";\r\n\r\nexport type GiscusLang = (typeof SUPPORTED_LANGUAGES)[number];\r\n\r\nexport type GiscusLoading = \"lazy\" | \"eager\";\r\n\r\nexport interface GiscusProps {\r\n  id?: string | undefined;\r\n  repo: GiscusRepo;\r\n  repoId: string;\r\n  category?: string | undefined;\r\n  categoryId?: string | undefined;\r\n  mapping: GiscusMapping;\r\n  term?: string | undefined;\r\n  theme?: GiscusTheme | undefined;\r\n  reactionsEnabled?: BooleanString | undefined;\r\n  strict?: BooleanString | undefined;\r\n  emitMetadata?: BooleanString | undefined;\r\n  inputPosition?: GiscusInputPosition | undefined;\r\n  lang?: GiscusLang | undefined;\r\n  loading?: GiscusLoading | undefined;\r\n}\r\n\r\nconst giscusOptions = COMMENT_OPTIONS;\r\nconst enableGiscus = Boolean(\r\n  giscusOptions.repo &&\r\n    giscusOptions.repoId &&\r\n    giscusOptions.category &&\r\n    giscusOptions.categoryId\r\n);\r\n\r\nconst { repo, repoId, category, categoryId } = giscusOptions;\r\n\r\nexport default defineComponent({\r\n  name: \"GiscusComment\",\r\n\r\n  props: {\r\n    /**\r\n     * Whether the component is in darkmode\r\n     *\r\n     * 组件是否处于夜间模式\r\n     */\r\n    darkmode: Boolean,\r\n  },\r\n\r\n  setup(props) {\r\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\r\n    const page = usePageData();\r\n    const loaded = ref(false);\r\n\r\n    const giscusLang = computed(() => {\r\n      const lang = usePageLang().value as GiscusLang;\r\n\r\n      if (SUPPORTED_LANGUAGES.includes(lang)) return lang;\r\n\r\n      const shortCode = lang.split(\"-\")[0] as GiscusLang;\r\n\r\n      if (SUPPORTED_LANGUAGES.includes(shortCode)) return shortCode;\r\n\r\n      return \"en\";\r\n    });\r\n\r\n    const enableComment = computed(() => {\r\n      if (!enableGiscus) return false;\r\n      const pluginConfig = giscusOptions.comment !== false;\r\n      const pageConfig = frontmatter.value.comment;\r\n\r\n      return (\r\n        // Enable in page\r\n        Boolean(pageConfig) ||\r\n        // not disabled in anywhere\r\n        (pluginConfig !== false && pageConfig !== false)\r\n      );\r\n    });\r\n\r\n    const config = computed(\r\n      () =>\r\n        <GiscusProps>{\r\n          repo,\r\n          repoId,\r\n          category,\r\n          categoryId,\r\n          lang: giscusLang.value,\r\n          theme: props.darkmode\r\n            ? giscusOptions.darkTheme || \"dark\"\r\n            : giscusOptions.lightTheme || \"light\",\r\n          mapping: giscusOptions.mapping || \"pathname\",\r\n          term: withBase(page.value.path),\r\n          inputPosition: giscusOptions.inputPosition || \"top\",\r\n          reactionsEnabled:\r\n            giscusOptions.reactionsEnabled === false ? \"0\" : \"1\",\r\n          strict: giscusOptions.strict === false ? \"0\" : \"1\",\r\n          loading: giscusOptions.lazyLoading === false ? \"eager\" : \"lazy\",\r\n          emitMetadata: \"0\",\r\n        }\r\n    );\r\n\r\n    onMounted(async () => {\r\n      await import(/* webpackChunkName: \"giscus\" */ \"giscus\");\r\n      loaded.value = true;\r\n    });\r\n\r\n    return (): VNode =>\r\n      h(\r\n        \"div\",\r\n        {\r\n          class: [\r\n            \"giscus-wrapper\",\r\n            { \"input-top\": giscusOptions.inputPosition !== \"bottom\" },\r\n          ],\r\n          id: \"comment\",\r\n          style: {\r\n            display: enableComment.value ? \"block\" : \"none\",\r\n          },\r\n        },\r\n        loaded.value ? h(\"giscus-widget\", config.value) : h(LoadingIcon)\r\n      );\r\n  },\r\n});\r\n"],"names":[],"mappings":"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"}